<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Chatroom</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap Icons for UI icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/chatroom_admin.css">
</head>
<body>
    <!-- Skip to main content link for screen readers -->
    <a href="#chat-body" class="sr-only">Skip to main content</a>
    
    <!-- ===== TOP BAR: Navigation and User Info ===== -->
    <nav class="chat-navbar" aria-label="Chat navigation">
        <!-- Back button -->
        <button class="nav-back" id="chat-back-btn" aria-label="Back to user list">
            <i class="bi bi-arrow-left" aria-hidden="true"></i>
        </button>
        <!-- Profile photo, name, role, and status -->
        <div class="nav-profile">
            <img src="images/default-avatar.png" alt="User profile photo" class="profile-photo" id="chat-user-avatar">
            <div class="profile-info">
                <span class="profile-name" id="chat-user-name">User Name</span>
                <span class="profile-role-badge" id="chat-user-role">User</span>
                <span class="profile-status online" id="chat-user-status" aria-live="polite">Online</span>
            </div>
        </div>
        <!-- Menu (three dots) -->
        <button class="nav-menu" aria-label="Additional options menu">
            <i class="bi bi-three-dots-vertical" aria-hidden="true"></i>
        </button>
    </nav>

    <!-- ===== CHAT BODY: Message Bubbles ===== -->
    <main class="chat-body" id="chat-body" aria-label="Chat conversation" tabindex="0">
        <!-- Loading state -->
        <div class="chat-loading" aria-live="polite">
            <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <!-- Message bubbles will be rendered here dynamically -->
    </main>

    <!-- ===== BOTTOM INPUT BAR ===== -->
    <form class="chat-input-bar" id="chat-input-bar" autocomplete="off" aria-label="Message input form">
        <!-- Emoji button -->
        <button type="button" class="input-emoji" aria-label="Choose emoji">
            <i class="bi bi-emoji-smile" aria-hidden="true"></i>
        </button>
        <!-- Chat input field -->
        <input type="text" class="input-message" id="input-message" placeholder="Type a message..." required aria-label="Type a message">
        <!-- Send button -->
        <button type="submit" class="input-send" aria-label="Send message">
            <i class="bi bi-send" aria-hidden="true"></i>
        </button>
    </form>

    <!-- Context menu template (hidden) -->
    <template id="context-menu-template">
        <div class="bubble-context-menu">
            <button type="button" class="copy-message">
                <i class="bi bi-clipboard" aria-hidden="true"></i> Copy
            </button>
            <button type="button" class="delete-message danger">
                <i class="bi bi-trash" aria-hidden="true"></i> Delete
            </button>
        </div>
    </template>

    <!-- Copied notification -->
    <div id="chat-copied-popup" aria-live="polite" aria-atomic="true">Message copied to clipboard</div>

    <!-- JS for chatroom admin -->
    <!-- Tambahkan CDN Supabase sebelum script custom untuk mencegah race condition -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Centralized Supabase client must be loaded before other scripts -->
    <script src="js/supabaseClient.js"></script>
    <script src="js/chatroom_admin.js"></script>
    
    <script>
        // Remove loading state after content loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loadingElement = document.querySelector('.chat-loading');
                if (loadingElement) {
                    loadingElement.style.display = 'none';
                }
            }, 1000);
        });
    </script>
</body>
</html>
